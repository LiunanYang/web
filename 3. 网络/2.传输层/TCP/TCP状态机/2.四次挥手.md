TCP 是全双工的，在断开连接时两端都需要发送 FIN 和 ACK

为什么四次挥手：
三次握手时没有数据传输，服务端 SYN、ACK 可以同时传输，但是挥手时有数据传输，服务端 FIN、ACK 要分开传输

## 第一次挥手
- 客户端数据发送完成，需要向服务端发送连接释放请求，发送 FIN 包（`FIN=1` ，序号 `seq=x`）
- 客户端进入 `FIN_WAIT` 状态

## 第二次挥手
- 服务器会发送一个 ACK 包（`ACK=1`，确认号 `ack=x+1`），代表收到了这个连接释放请求
- 服务器进入`CLOSE_WAIT`状态

## 第三次挥手
- 数据发送完毕后，服务器发送 FIN 包（`FIN=1`，序号`seq=y`）
- 服务器进入`LAST-ACK`状态。

通过延迟确认的技术（通常有时间限制，否则对方会误认为需要重传），可以将第二次和第三次握手合并，延迟 ACK 包的发送。

## 第四次挥手
- 客户端收到释放请求 FIN 包后，发送一个 ACK 包（`ACK=1`，确认号`ack=y+1`）表示收到了连接关闭请求
- 客户端进入`TIME-WAIT`状态
- 该状态会持续 2MSL（2倍的最大段生存期，指报文段在网络中生存的时间） 时间，该时间段内服务端没有重发请求的话，就进入 `CLOSED` 状态
- 当服务端收到确认应答后，也进入 CLOSED 状态
